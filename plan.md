# 休暇申請システム 実装計画書

## 1. プロジェクトの目的

`specifications.md` に定義された要件に基づき、Firebase を活用したサーバーレスの休暇申請ウェブアプリケーションを開発する。

## 2. 全体スケジュール（マイルストーン）

- **フェーズ1: 基盤構築と認証機能の実装**
- **フェーズ2: 休暇申請・承認フローの中核機能実装**
- **フェーズ3: 管理者・総務向け機能の実装**
- **フェーズ4: 通知機能と最終調整**
- **フェーズ5: テストとデプロイ**

---

## 3. 実装タスク詳細

### フェーズ1: 基盤構築と認証機能の実装

*   **担当範囲:** ログイン機能、ユーザー情報のデータ構造、基本的な画面骨格

| タスク ID | タスク内容 | 成果物 |
| :--- | :--- | :--- |
| **1-1** | **Firebaseプロジェクト設定** | Firebase プロジェクト、各種SDKのセットアップ |
| | - Firebaseプロジェクトを作成し、Authentication, Firestore, Hosting, Functions を有効化する。<br>- Webアプリケーションの初期設定を行う。 | |
| **1-2** | **パスワードレス認証の実装** | ログイン画面、認証メール送信ロジック |
| | - メールアドレスを入力し、認証リンクを送信するUIを作成する。<br>- 認証リンクを受け取り、ユーザーを認証するFirebase Functionsを実装する。 | |
| **1-3** | **ユーザーデータモデルの設計と実装** | Firestoreの `users` コレクション、セキュリティルール |
| | - `specifications.md` に基づき `users` コレクションを Firestore に設定する。<br>- 認証済みユーザーのみが自身の情報を読み書きできる Firestore セキュリティルールを記述する。 | |
| **1-4** | **初期管理者アカウントの設定** | 運用手順書、設定スクリプト（任意） |
| | - アプリケーションのデプロイ時に、最初のシステム管理者アカウントを Firestore に手動またはスクリプトで登録する手順を確立する。 | |

### フェーズ2: 休暇申請・承認フローの中核機能実装

*   **担当範囲:** 一般ユーザーによる申請、承認ユーザーによる承認・差し戻し

| タスク ID | タスク内容 | 成果物 |
| :--- | :--- | :--- |
| **2-1** | **申請関連データモデルの実装** | `leave_applications` コレクション、セキュリティルール |
| | - `leave_applications` および `approval_flows` コレクションを Firestore に設定する。<br>- 適切な権限（申請者、承認者、総務）を持つユーザーのみがドキュメントを操作できるセキュリティルールを記述する。 | |
| **2-2** | **休暇申請画面の実装（一般ユーザー）** | 申請フォームコンポーネント、申請一覧コンポーネント |
| | - 仕様書通りの入力フィールド（休暇種別、期間、理由など）を持つ申請フォームを作成する。<br>- 自身の申請履歴とステータスを一覧表示する画面を作成する。<br>- 差し戻された申請の再申請・削除ロジックを実装する。 | |
| **2-3** | **承認画面の実装（承認ユーザー）** | 承認待ち一覧コンポーネント、申請詳細モーダル/ページ |
| | - 自身が承認すべき申請を一覧で表示するダッシュボードを作成する。<br>- 申請詳細を確認し、「承認」「差し戻し（コメント必須）」を行えるUIを実装する。<br>- 処理済み申請の履歴を確認できる画面を作成する。 | |

### フェーズ3: 管理者・総務向け機能の実装

*   **担当範囲:** システム管理者と総務担当者向けの管理画面

| タスク ID | タスク内容 | 成果物 |
| :--- | :--- | :--- |
| **3-1** | **ユーザー管理画面の実装（システム管理者）** | ユーザー管理画面コンポーネント |
| | - 全ユーザーの情報をCRUD（作成、読み取り、更新、削除）できるUIを作成する。<br>- ユーザーへのロール（複数可）割り当て機能を実装する。 | |
| **3-2** | **承認フロー設定画面の実装（システム管理者）** | 承認フロー設定画面コンポーネント |
| | - 申請者(user)と承認者(approver)を紐付けるN:Nのマッピング管理UIを実装する。 | |
| **3-3** | **全申請状況確認画面の実装（総務担当者）** | 全申請一覧コンポーネント |
| | - 全従業員の申請を横断的に閲覧できる一覧画面を作成する。<br>- 総務担当者が特定の申請を削除できる機能を実装する。 | |

### フェーズ4: 通知機能と最終調整

*   **担当範囲:** メール通知、全体的なUI/UXの改善

| タスク ID | タスク内容 | 成果物 |
| :--- | :--- | :--- |
| **4-1** | **イベントトリガーによるメール通知機能** | Firebase Functions (onWriteトリガー)、メールテンプレート |
| | - `leave_applications` コレクションへの書き込み（新規、承認、差し戻し）をトリガーとして、関係者にメールを送信するCloud Functionsを実装する。<br>- `SendGrid` や `Mailgun` などの外部サービス連携を設定する。 | |
| **4-2** | **通知メール内URLのトークン設定** | Firebase Functionsのロジック |
| | - 通知メールに記載する申請確認URLに、有効期限1日のセキュアなトークンを付与するロジックを実装する。 | |
| **4-3** | **UI/UXの改善** | 洗練されたUIコンポーネント |
| | - 各画面の使いやすさや見た目を改善し、一貫性のあるデザインを適用する。 | |

### フェーズ5: テストとデプロイ

*   **担当範囲:** 品質保証、本番環境へのリリース

| タスク ID | タスク内容 | 成果物 |
| :--- | :--- | :--- |
| **5-1** | **総合テスト** | テストケース、バグ報告書 |
| | - 全てのロール（一般、承認、総務、管理）とユースケースに基づいたE2E（エンドツーエンド）テストを実施する。<br>- セキュリティルールが意図通りに機能しているかテストする。 | |
| **5-2** | **本番環境へのデプロイ** | デプロイ手順書 |
| | - Firebase Hosting に静的ファイルをデプロイする。<br>- Firestore のセキュリティルールとインデックスをデプロイする。<br>- Cloud Functions をデプロイする。 | |
| **5-3** | **最終確認** | - | - 本番環境で主要な機能が正常に動作することを最終確認する。 | |
